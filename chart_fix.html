<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOGE/JPY Trading Dashboard - Chart Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { 
            background-color: #121212; 
            color: #ffffff; 
            font-family: Arial, sans-serif;
        }
        .card { 
            background-color: #1e1e1e; 
            border: 1px solid #333; 
            margin-bottom: 20px;
        }
        .card-header { 
            background-color: #2a2a2a; 
            border-bottom: 1px solid #444;
        }
        .card-header h5, .card-header h6 { 
            color: #ffffff !important; 
            margin: 0;
        }
        .stat-value { 
            font-size: 1.5rem; 
            font-weight: bold; 
            color: #00ff88;
        }
        .chart-container { 
            background-color: #1e1e1e; 
            border-radius: 8px; 
            padding: 20px;
            text-align: center;
        }
        canvas { 
            border: 2px solid #333; 
            border-radius: 8px; 
            background-color: #000000;
            max-width: 100%;
        }
        .btn-outline-primary {
            border-color: #007bff;
            color: #007bff;
        }
        .btn-outline-primary:hover {
            background-color: #007bff;
            color: white;
        }
        .btn-outline-primary.active {
            background-color: #007bff;
            color: white;
        }
        .navbar-brand {
            color: #00ff88 !important;
            font-weight: bold;
        }
        .alert-success {
            background-color: #1e3a2e;
            border-color: #2d5a3d;
            color: #7dd3fc;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line me-2"></i>CryptoTraderAI
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Price Info -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">üí∞ ÁèæÂú®‰æ°Ê†º</h6>
                    </div>
                    <div class="card-body text-center">
                        <div class="stat-value" id="current-price">25.179ÂÜÜ</div>
                        <div class="small text-muted">DOGE/JPY</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">üìà 24ÊôÇÈñìÂ§âÂãï</h6>
                    </div>
                    <div class="card-body text-center">
                        <div class="stat-value" id="price-change">+2.5%</div>
                        <div class="small text-muted">Â§âÂãïÁéá</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">üìä ÂèñÂºïÈáè</h6>
                    </div>
                    <div class="card-body text-center">
                        <div class="stat-value" id="volume">25.4M</div>
                        <div class="small text-muted">24ÊôÇÈñì</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">‚è∞ ÊúÄÁµÇÊõ¥Êñ∞</h6>
                    </div>
                    <div class="card-body text-center">
                        <div class="stat-value small" id="last-update">07:52</div>
                        <div class="small text-muted">JST</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chart -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">üìä DOGE/JPY „É™„Ç¢„É´„Çø„Ç§„É†„ÉÅ„É£„Éº„Éà</h5>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="changeInterval('5m')">5ÂàÜ</button>
                            <button type="button" class="btn btn-outline-primary" onclick="changeInterval('15m')">15ÂàÜ</button>
                            <button type="button" class="btn btn-outline-primary" onclick="changeInterval('30m')">30ÂàÜ</button>
                            <button type="button" class="btn btn-outline-primary active" onclick="changeInterval('1h')">1ÊôÇÈñì</button>
                            <button type="button" class="btn btn-outline-primary" onclick="changeInterval('4h')">4ÊôÇÈñì</button>
                            <button type="button" class="btn btn-outline-primary" onclick="changeInterval('1d')">1Êó•</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="price-chart" width="900" height="450"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Technical Indicators -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0" style="color: #ffffff;">RSI (Relative Strength Index)</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="rsi-chart" width="400" height="200"></canvas>
                        <div class="d-flex justify-content-between mt-2">
                            <span style="color: #ffffff;">RSI: <span id="rsi-value" style="color: #00ff88;">--</span></span>
                            <span style="color: #ffffff;">Áä∂ÊÖã: <span id="rsi-status" class="badge bg-secondary">--</span></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0" style="color: #ffffff;">MACD</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="macd-chart" width="400" height="200"></canvas>
                        <div class="d-flex justify-content-between mt-2">
                            <span style="color: #ffffff;">MACD: <span id="macd-value" style="color: #00ff88;">--</span></span>
                            <span style="color: #ffffff;">„Ç∑„Ç∞„Éä„É´: <span id="macd-signal" style="color: #ff6b6b;">--</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0" style="color: #ffffff;">„Éú„É™„É≥„Ç∏„É£„Éº„Éê„É≥„Éâ</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="bollinger-chart" width="400" height="200"></canvas>
                        <div class="d-flex justify-content-between mt-2">
                            <span style="color: #ffffff;">‰∏äÈôê: <span id="bb-upper" style="color: #ff6b6b;">--</span></span>
                            <span style="color: #ffffff;">‰∏ãÈôê: <span id="bb-lower" style="color: #4ecdc4;">--</span></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0" style="color: #ffffff;">ÁßªÂãïÂπ≥ÂùáÁ∑ö</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="ma-chart" width="400" height="200"></canvas>
                        <div class="d-flex justify-content-between mt-2">
                            <span style="color: #ffffff;">SMA20: <span id="sma20" style="color: #ffeb3b;">--</span></span>
                            <span style="color: #ffffff;">EMA20: <span id="ema20" style="color: #ff9500;">--</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status -->
        <div class="row">
            <div class="col-12">
                <div class="alert alert-success" role="alert">
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>„ÉÅ„É£„Éº„Éà‰øÆÊ≠£ÁâàÁ®ºÂÉç‰∏≠</strong> - „É™„Ç¢„É´„Çø„Ç§„É†„Éá„Éº„ÇøÊõ¥Êñ∞
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Chart Fix Dashboard Loading...');
        
        // Chart variables
        let canvas = null;
        let ctx = null;
        let currentInterval = '1h';
        let chartData = [];
        let animationId = null;
        
        // Indicator canvases
        let rsiCanvas = null;
        let rsiCtx = null;
        let macdCanvas = null;
        let macdCtx = null;
        let bollingerCanvas = null;
        let bollingerCtx = null;
        let maCanvas = null;
        let maCtx = null;
        
        // Indicator data
        let indicatorData = {};
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing chart...');
            
            // Get canvas and context
            canvas = document.getElementById('price-chart');
            if (!canvas) {
                console.error('Canvas not found!');
                return;
            }
            
            ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error('Canvas context not available!');
                return;
            }
            
            console.log('Canvas initialized successfully');
            
            // Initialize indicator canvases
            initializeIndicatorCanvases();
            
            // Draw initial chart immediately
            drawChart();
            
            // Set up data loading
            loadPriceData();
            loadIndicatorData();
            setInterval(() => {
                loadPriceData();
                loadIndicatorData();
            }, 30000); // Update every 30 seconds
        });
        
        function drawChart() {
            if (!ctx || !canvas) {
                console.error('Canvas not ready');
                return;
            }
            
            console.log('Drawing chart...');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Generate sample data
            const data = generateSampleData();
            
            // Chart dimensions
            const padding = 60;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);
            
            // Find min/max prices
            const prices = data.map(d => d.price);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const priceRange = maxPrice - minPrice || 1;
            
            // Draw title
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('DOGE/JPY ‰æ°Ê†º„ÉÅ„É£„Éº„Éà (' + currentInterval + ')', canvas.width / 2, 30);
            
            // Draw axes
            ctx.strokeStyle = '#444444';
            ctx.lineWidth = 1;
            ctx.beginPath();
            // Y-axis
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            // X-axis
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // Draw price line
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i < data.length; i++) {
                const x = padding + (i / (data.length - 1)) * chartWidth;
                const y = canvas.height - padding - ((data[i].price - minPrice) / priceRange) * chartHeight;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // Draw price labels
            ctx.fillStyle = '#ffffff';
            ctx.font = '12px Arial';
            ctx.textAlign = 'right';
            
            for (let i = 0; i <= 5; i++) {
                const price = minPrice + (priceRange / 5) * i;
                const y = canvas.height - padding - (i / 5) * chartHeight;
                ctx.fillText('¬•' + price.toFixed(3), padding - 10, y + 4);
            }
            
            // Draw current price indicator
            const currentPrice = data[data.length - 1].price;
            const currentY = canvas.height - padding - ((currentPrice - minPrice) / priceRange) * chartHeight;
            
            ctx.fillStyle = '#00ff88';
            ctx.beginPath();
            ctx.arc(canvas.width - padding, currentY, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw current price label
            ctx.fillStyle = '#00ff88';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('¬•' + currentPrice.toFixed(3), canvas.width - padding + 15, currentY + 5);
            
            console.log('Chart drawn successfully with', data.length, 'data points');
        }
        
        function generateSampleData() {
            const data = [];
            const basePrice = 25.179;
            const points = 24;
            
            for (let i = 0; i < points; i++) {
                const time = new Date(Date.now() - (points - i) * 60 * 60 * 1000);
                const variation = (Math.random() - 0.5) * 0.8;
                const price = Math.max(basePrice + variation, basePrice * 0.98);
                
                data.push({
                    time: time,
                    price: price
                });
            }
            
            return data;
        }
        
        function loadPriceData() {
            console.log('Loading price data...');
            
            fetch('/api/ticker')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.data) {
                        console.log('Price data loaded:', data.data);
                        updatePriceDisplay(data.data);
                        drawChart(); // Redraw chart with new data
                    }
                })
                .catch(error => {
                    console.error('Error loading price data:', error);
                });
        }
        
        function updatePriceDisplay(data) {
            // Update price display
            document.getElementById('current-price').textContent = '¬•' + data.price.toFixed(3);
            
            // Update timestamp
            const now = new Date();
            document.getElementById('last-update').textContent = 
                now.getHours().toString().padStart(2, '0') + ':' + 
                now.getMinutes().toString().padStart(2, '0');
            
            // Update volume
            if (data.volume) {
                const volume = (data.volume / 1000000).toFixed(1);
                document.getElementById('volume').textContent = volume + 'M';
            }
        }
        
        function changeInterval(interval) {
            currentInterval = interval;
            console.log('Changing interval to:', interval);
            
            // Update active button
            document.querySelectorAll('.btn-group button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Redraw chart
            drawChart();
        }
        
        // Start chart animation
        function startAnimation() {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            
            function animate() {
                drawChart();
                animationId = requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        function initializeIndicatorCanvases() {
            // Initialize RSI canvas
            rsiCanvas = document.getElementById('rsi-chart');
            if (rsiCanvas) {
                rsiCtx = rsiCanvas.getContext('2d');
                console.log('RSI canvas initialized');
            }
            
            // Initialize MACD canvas
            macdCanvas = document.getElementById('macd-chart');
            if (macdCanvas) {
                macdCtx = macdCanvas.getContext('2d');
                console.log('MACD canvas initialized');
            }
            
            // Initialize Bollinger Bands canvas
            bollingerCanvas = document.getElementById('bollinger-chart');
            if (bollingerCanvas) {
                bollingerCtx = bollingerCanvas.getContext('2d');
                console.log('Bollinger Bands canvas initialized');
            }
            
            // Initialize Moving Average canvas
            maCanvas = document.getElementById('ma-chart');
            if (maCanvas) {
                maCtx = maCanvas.getContext('2d');
                console.log('Moving Average canvas initialized');
            }
        }
        
        function loadIndicatorData() {
            console.log('Loading indicator data...');
            
            fetch('/api/indicators')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.data) {
                        console.log('Indicator data loaded:', data.data);
                        indicatorData = data.data;
                        updateIndicatorDisplays();
                        drawIndicators();
                    } else {
                        console.log('Using simulated indicator data');
                        generateSimulatedIndicators();
                        updateIndicatorDisplays();
                        drawIndicators();
                    }
                })
                .catch(error => {
                    console.error('Error loading indicator data:', error);
                    generateSimulatedIndicators();
                    updateIndicatorDisplays();
                    drawIndicators();
                });
        }
        
        function generateSimulatedIndicators() {
            const currentPrice = 25.065;
            
            indicatorData = {
                rsi: Math.random() * 100,
                macd: {
                    macd: (Math.random() - 0.5) * 2,
                    signal: (Math.random() - 0.5) * 1.5,
                    histogram: (Math.random() - 0.5) * 0.5
                },
                bollinger_bands: {
                    upper: currentPrice + Math.random() * 2,
                    middle: currentPrice,
                    lower: currentPrice - Math.random() * 2
                },
                moving_averages: {
                    sma: currentPrice + (Math.random() - 0.5) * 1,
                    ema: currentPrice + (Math.random() - 0.5) * 0.8
                }
            };
        }
        
        function updateIndicatorDisplays() {
            console.log('Updating indicator displays with data:', indicatorData);
            
            // Update RSI
            if (indicatorData.rsi !== undefined) {
                const rsiElement = document.getElementById('rsi-value');
                if (rsiElement) {
                    rsiElement.textContent = indicatorData.rsi.toFixed(2);
                    console.log('RSI updated:', indicatorData.rsi);
                }
                
                const rsiStatus = indicatorData.rsi > 70 ? 'Â£≤„Çâ„Çå„Åô„Åé' : indicatorData.rsi < 30 ? 'Ë≤∑„Çè„Çå„Åô„Åé' : '‰∏≠Á´ã';
                const rsiClass = indicatorData.rsi > 70 ? 'bg-danger' : indicatorData.rsi < 30 ? 'bg-success' : 'bg-secondary';
                const statusElement = document.getElementById('rsi-status');
                if (statusElement) {
                    statusElement.textContent = rsiStatus;
                    statusElement.className = 'badge ' + rsiClass;
                }
            }
            
            // Update MACD
            if (indicatorData.macd) {
                const macdElement = document.getElementById('macd-value');
                const signalElement = document.getElementById('macd-signal');
                if (macdElement) {
                    macdElement.textContent = indicatorData.macd.macd.toFixed(4);
                    console.log('MACD updated:', indicatorData.macd.macd);
                }
                if (signalElement) {
                    signalElement.textContent = indicatorData.macd.signal.toFixed(4);
                }
            }
            
            // Update Bollinger Bands
            if (indicatorData.bollinger_bands) {
                const upperElement = document.getElementById('bb-upper');
                const lowerElement = document.getElementById('bb-lower');
                if (upperElement) {
                    upperElement.textContent = '¬•' + indicatorData.bollinger_bands.upper.toFixed(3);
                    console.log('Bollinger upper updated:', indicatorData.bollinger_bands.upper);
                }
                if (lowerElement) {
                    lowerElement.textContent = '¬•' + indicatorData.bollinger_bands.lower.toFixed(3);
                }
            }
            
            // Update Moving Averages
            if (indicatorData.moving_averages) {
                const smaElement = document.getElementById('sma20');
                const emaElement = document.getElementById('ema20');
                if (smaElement) {
                    smaElement.textContent = '¬•' + indicatorData.moving_averages.sma.toFixed(3);
                    console.log('SMA updated:', indicatorData.moving_averages.sma);
                }
                if (emaElement) {
                    emaElement.textContent = '¬•' + indicatorData.moving_averages.ema.toFixed(3);
                }
            }
        }
        
        function drawIndicators() {
            drawRSI();
            drawMACD();
            drawBollingerBands();
            drawMovingAverages();
        }
        
        function drawRSI() {
            if (!rsiCtx || !indicatorData.rsi) {
                console.log('RSI draw skipped - missing context or data');
                return;
            }
            
            console.log('Drawing RSI chart with value:', indicatorData.rsi);
            
            const canvas = rsiCanvas;
            const ctx = rsiCtx;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const padding = 30;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);
            
            // Draw grid lines
            ctx.strokeStyle = '#333333';
            ctx.lineWidth = 1;
            
            // Horizontal grid lines
            for (let i = 0; i <= 4; i++) {
                const y = padding + (chartHeight / 4) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }
            
            // Draw RSI level lines
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 2;
            
            // 30% line (oversold)
            const oversoldY = padding + chartHeight * 0.7;
            ctx.beginPath();
            ctx.moveTo(padding, oversoldY);
            ctx.lineTo(canvas.width - padding, oversoldY);
            ctx.stroke();
            
            // 70% line (overbought)
            const overboughtY = padding + chartHeight * 0.3;
            ctx.beginPath();
            ctx.moveTo(padding, overboughtY);
            ctx.lineTo(canvas.width - padding, overboughtY);
            ctx.stroke();
            
            // Draw RSI value bar
            const rsiY = padding + chartHeight * (1 - indicatorData.rsi / 100);
            ctx.fillStyle = indicatorData.rsi > 70 ? '#ff6b6b' : indicatorData.rsi < 30 ? '#4ecdc4' : '#ffeb3b';
            ctx.fillRect(padding + chartWidth * 0.3, rsiY, chartWidth * 0.4, padding + chartHeight - rsiY);
            
            // Draw current RSI line
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(padding, rsiY);
            ctx.lineTo(canvas.width - padding, rsiY);
            ctx.stroke();
            
            // Draw labels
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('RSI: ' + indicatorData.rsi.toFixed(1), padding + 5, padding + 20);
            ctx.fillText('70', padding + 5, overboughtY - 5);
            ctx.fillText('30', padding + 5, oversoldY - 5);
            ctx.fillText('0', padding + 5, padding + chartHeight - 5);
            ctx.fillText('100', padding + 5, padding + 10);
            
            console.log('RSI chart drawn successfully');
        }
        
        function drawMACD() {
            if (!macdCtx || !indicatorData.macd) {
                console.log('MACD draw skipped - missing context or data');
                return;
            }
            
            console.log('Drawing MACD chart with values:', indicatorData.macd);
            
            const canvas = macdCanvas;
            const ctx = macdCtx;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const padding = 30;
            const centerY = canvas.height / 2;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);
            
            // Draw grid lines
            ctx.strokeStyle = '#333333';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = padding + (chartHeight / 4) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }
            
            // Draw center line
            ctx.strokeStyle = '#555555';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, centerY);
            ctx.lineTo(canvas.width - padding, centerY);
            ctx.stroke();
            
            // Draw MACD histogram
            const macdValue = indicatorData.macd.macd;
            const signalValue = indicatorData.macd.signal;
            const histogram = indicatorData.macd.histogram || (macdValue - signalValue);
            
            const histogramHeight = Math.abs(histogram) * 100;
            const histogramY = histogram > 0 ? centerY - histogramHeight : centerY;
            
            ctx.fillStyle = histogram > 0 ? '#00ff88' : '#ff6b6b';
            ctx.fillRect(padding + chartWidth * 0.4, histogramY, chartWidth * 0.2, Math.abs(histogramHeight));
            
            // Draw MACD line
            const macdY = centerY - (macdValue * 100);
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(padding, centerY);
            ctx.lineTo(canvas.width - padding, macdY);
            ctx.stroke();
            
            // Draw Signal line
            const signalY = centerY - (signalValue * 100);
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, centerY);
            ctx.lineTo(canvas.width - padding, signalY);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('MACD: ' + macdValue.toFixed(4), padding + 5, padding + 20);
            ctx.fillText('Signal: ' + signalValue.toFixed(4), padding + 5, padding + 35);
            ctx.fillText('Hist: ' + histogram.toFixed(4), padding + 5, padding + 50);
            
            console.log('MACD chart drawn successfully');
        }
        
        function drawBollingerBands() {
            if (!bollingerCtx || !indicatorData.bollinger_bands) {
                console.log('Bollinger Bands draw skipped - missing context or data');
                return;
            }
            
            console.log('Drawing Bollinger Bands chart with values:', indicatorData.bollinger_bands);
            
            const canvas = bollingerCanvas;
            const ctx = bollingerCtx;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const padding = 30;
            const chartHeight = canvas.height - (padding * 2);
            const chartWidth = canvas.width - (padding * 2);
            
            const upper = indicatorData.bollinger_bands.upper;
            const middle = indicatorData.bollinger_bands.middle;
            const lower = indicatorData.bollinger_bands.lower;
            
            const range = upper - lower || 1;
            
            // Calculate positions based on price values
            const upperY = padding + chartHeight * 0.1;
            const middleY = padding + chartHeight * 0.5;
            const lowerY = padding + chartHeight * 0.9;
            
            // Draw background band area
            ctx.fillStyle = 'rgba(255, 235, 59, 0.1)';
            ctx.fillRect(padding, upperY, chartWidth, lowerY - upperY);
            
            // Draw upper band
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(padding, upperY);
            ctx.lineTo(canvas.width - padding, upperY);
            ctx.stroke();
            
            // Draw middle band (SMA)
            ctx.strokeStyle = '#ffeb3b';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(padding, middleY);
            ctx.lineTo(canvas.width - padding, middleY);
            ctx.stroke();
            
            // Draw lower band
            ctx.strokeStyle = '#4ecdc4';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(padding, lowerY);
            ctx.lineTo(canvas.width - padding, lowerY);
            ctx.stroke();
            
            // Draw price position indicator
            const currentPrice = 25.08; // Use current price
            const priceRatio = (currentPrice - lower) / range;
            const priceY = lowerY - (priceRatio * (lowerY - upperY));
            
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(canvas.width - padding - 20, priceY, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            // Labels
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Upper: ¬•' + upper.toFixed(3), padding + 5, upperY - 5);
            ctx.fillText('Middle: ¬•' + middle.toFixed(3), padding + 5, middleY - 5);
            ctx.fillText('Lower: ¬•' + lower.toFixed(3), padding + 5, lowerY + 20);
            
            console.log('Bollinger Bands chart drawn successfully');
        }
        
        function drawMovingAverages() {
            if (!maCtx || !indicatorData.moving_averages) {
                console.log('Moving Averages draw skipped - missing context or data');
                return;
            }
            
            console.log('Drawing Moving Averages chart with values:', indicatorData.moving_averages);
            
            const canvas = maCanvas;
            const ctx = maCtx;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Set background
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const padding = 30;
            const chartHeight = canvas.height - (padding * 2);
            const chartWidth = canvas.width - (padding * 2);
            
            const sma = indicatorData.moving_averages.sma;
            const ema = indicatorData.moving_averages.ema;
            
            // Draw grid lines
            ctx.strokeStyle = '#333333';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = padding + (chartHeight / 4) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }
            
            // Calculate relative positions
            const avgPrice = (sma + ema) / 2;
            const priceRange = Math.abs(sma - ema) || 1;
            
            const smaY = padding + chartHeight * 0.4;
            const emaY = padding + chartHeight * 0.6;
            
            // Draw SMA line with trend visualization
            ctx.strokeStyle = '#ffeb3b';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(padding, smaY);
            ctx.lineTo(canvas.width - padding, smaY);
            ctx.stroke();
            
            // Draw EMA line with trend visualization
            ctx.strokeStyle = '#ff9500';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(padding, emaY);
            ctx.lineTo(canvas.width - padding, emaY);
            ctx.stroke();
            
            // Draw crossover visualization
            if (sma > ema) {
                ctx.fillStyle = 'rgba(255, 235, 59, 0.3)';
            } else {
                ctx.fillStyle = 'rgba(255, 149, 0, 0.3)';
            }
            ctx.fillRect(padding, Math.min(smaY, emaY), chartWidth, Math.abs(smaY - emaY));
            
            // Draw current price indicator
            const currentPrice = 25.08;
            let priceY;
            if (currentPrice > Math.max(sma, ema)) {
                priceY = padding + chartHeight * 0.2;
            } else if (currentPrice < Math.min(sma, ema)) {
                priceY = padding + chartHeight * 0.8;
            } else {
                priceY = padding + chartHeight * 0.5;
            }
            
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(canvas.width - padding - 20, priceY, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            // Labels
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('SMA20: ¬•' + sma.toFixed(3), padding + 5, padding + 20);
            ctx.fillText('EMA20: ¬•' + ema.toFixed(3), padding + 5, padding + 35);
            
            // Trend indicator
            const trend = sma > ema ? 'SMA > EMA (‰∏ãÈôç„Éà„É¨„É≥„Éâ)' : 'EMA > SMA (‰∏äÊòá„Éà„É¨„É≥„Éâ)';
            ctx.font = '12px Arial';
            ctx.fillText(trend, padding + 5, canvas.height - padding + 20);
            
            console.log('Moving Averages chart drawn successfully');
        }
        
        console.log('Chart Fix Dashboard loaded successfully');
    </script>
</body>
</html>