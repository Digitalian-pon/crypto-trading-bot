# GMO Coin 24時間自動トレーディングボット - プロジェクト完了記録

## 🎯 プロジェクト概要
- **作成日**: 2025年8月7日
- **ユーザー**: thuyo (thuyoshi1@gmail.com) 
- **目的**: GMO CoinでのDOGE/JPY自動取引システム構築
- **状態**: ✅ 完全稼働中（トレンド転換機能搭載）

## 🌐 稼働中システム情報
- **URL**: https://web-production-1f4ce.up.railway.app ✅ **正常稼働中**
- **ホスティング**: Railway (無料24時間稼働)
- **GitHub**: https://github.com/Digitalian-pon/crypto-trading-bot
- **監視通貨**: DOGE/JPY
- **更新間隔**: 30秒自動更新
- **現在価格**: ¥31.377 (2025年8月26日15:18時点)

## 💰 アカウント情報
- **残高**: 1,647 JPY + DOGE(90単位売りポジション) + その他
- **API認証**: GMO Coin API連携済み
- **API Key**: FXhblJAz9Ql0G3pCo5p/+S9zkFw6r2VC (32文字)
- **API Secret**: /YiZoJlRybHnKAO78go6Jt9LKQOS/EwEEe47UyEl6YbXo7XA84fL+Q/k3AEJeCBo (64文字)

## 📊 技術仕様
### 売買判断ロジック:
- **RSI**: < 35 (買い), > 65 (売り) - 信頼度 0.8
- **MACD**: ライン>シグナル&正値 (買い), ライン<シグナル&負値 (売り) - 信頼度 0.6
- **ボリンジャーバンド**: 下限付近 (買い), 上限付近 (売り) - 信頼度 0.7
- **実行条件**: 信頼度合計 0.8以上

### リスク管理:
- **最大投資額**: 残高の5%
- **損切り**: 2%下落で実行
- **利確**: 4%上昇で実行
- **最短取引間隔**: 30分

## 🛠️ システム構成
### ファイル構造:
```
crypto-trading-bot/
├── app.py                 # Flaskメインアプリ
├── main.py               # エントリーポイント
├── config.py             # 設定管理
├── models.py             # データベースモデル
├── services/
│   ├── gmo_api.py           # GMO Coin API
│   ├── technical_indicators.py  # テクニカル指標
│   ├── simple_trading_logic.py  # 売買判断ロジック
│   ├── risk_manager.py         # リスク管理
│   ├── notification_service.py # アラート機能
│   └── data_service.py         # データ取得
├── templates/
│   ├── simple_dashboard.html   # メインダッシュボード
│   └── simple_settings.html    # 設定画面
└── logs/ # 取引ログ保存場所
```

### 主要機能:
- ✅ リアルタイム価格監視
- ✅ 技術指標分析 (RSI, MACD, ボリンジャーバンド)
- ✅ 自動売買シグナル検出
- ✅ ウェブダッシュボード (PC/スマホ対応)
- ✅ 取引履歴記録
- ✅ エラーハンドリング
- 🆕 **トレンド転換時一括決済機能**
- 🆕 **反対ポジション自動実行**
- 🆕 **GMO Coin取引所ポジション同期**

## 🚨 重要な設定
### 環境変数 (Railway設定済み):
```
GMO_API_KEY = FXhblJAz9Ql0G3pCo5p/+S9zkFw6r2VC
GMO_API_SECRET = /YiZoJlRybHnKAO78go6Jt9LKQOS/EwEEe47UyEl6YbXo7XA84fL+Q/k3AEJeCBo
```

## 📱 操作方法
### ダッシュボード確認:
1. https://web-production-1f4ce.up.railway.app にアクセス
2. リアルタイム価格・シグナル確認
3. 30秒ごと自動更新

### 設定変更:
1. /settings ページで設定調整
2. リスク管理パラメータ変更
3. 自動取引ON/OFF切り替え

## 🔄 呼び出し方法
次回このプロジェクトについて質問する際は以下のように呼び出してください:

**"GMO Coinトレーディングボットの件"** または 
**"DOGE/JPY自動取引システムの件"** または
**"crypto trading bot project"**

## 🔄 レバレッジ取引API完全対応 (2025年8月25日更新)
### 📊 現在のポジション状況:
- **DOGE_JPY SELL**: 90単位 (9つのポジション)
- **平均価格**: 35.40円付近
- **含み損益**: +265 JPY (プラス)
- **証拠金**: 1,598円使用中
- **証拠金維持率**: 119.1% (安全レベル)

### 🔧 実装済みAPI機能:
- **`get_positions()`**: 建玉一覧取得 (`/v1/openPositions`)
- **`get_margin_account()`**: マージン口座情報取得
- **`close_position()`**: 個別建玉決済 (`/v1/closeOrder`)
- **`close_bulk_position()`**: 一括決済注文 (`/v1/closeBulkOrder`)
- **`close_all_positions_by_symbol()`**: 便利メソッド

### 🚀 トレンド転換時一括決済:
- **監視間隔**: 60秒間隔でトレンド強度監視
- **実行条件**: 強度0.7以上の`bullish` ↔ `bearish`転換時
- **一括決済**: 現在のSELL 90単位を自動決済
- **精度対応**: DOGE整数サイズ指定 (小数点問題解決済み)

### 動作フロー:
1. 60秒間隔でトレンド強度監視
2. 強度0.7以上の転換検出
3. `api.close_bulk_position('DOGE_JPY', 'SELL', 'MARKET', '90')` 実行
4. 新トレンド方向のポジション自動作成

## 📞 サポート対応履歴
- さくらVPS問題 → Railway無料ホスティングに移行
- API認証エラー → 修正完了
- ダッシュボード表示問題 → JavaScript修正完了
- 循環インポートエラー → 動的インポートで解決
- リアルタイム分析表示 → 実装完了
- **2025年8月22日**: 実取引機能修正 → インデントエラー・データ取得エラー解決
- **2025年8月22日**: トレンド転換時一括決済機能 → 実装完了
- **2025年8月25日**: レバレッジ取引API完全対応 → ポジション取得・一括決済実装完了
- **2025年8月26日**: 緊急システム修復 → Railwayクラッシュ・ボタン機能問題・DB初期化エラー全て解決 ✅

## 🎯 今後の改善案
- より多くの通貨ペア対応
- メール/LINE通知機能
- 詳細な取引履歴分析
- バックテスト機能
- ポートフォリオ管理
- トレンド転換閾値の動的調整

## 🚨 緊急修復作業記録 (2025年8月26日)
### 問題状況:
- Railwayデプロイメントクラッシュ (502エラー)
- ウェブサイトボタン機能不全
- データベース初期化エラー

### 実施した修復:
1. **データベースモデル修正** (`models.py`)
   - 循環インポートエラー解決
   - 動的モデル作成システム実装
   - `AttributeError: 'NoneType' object has no attribute 'Model'` 修正

2. **Flask アプリケーション修正** (`app.py`)
   - データベース初期化順序の最適化
   - モデルインポートタイミングの調整

3. **システム検証**
   - ローカル環境での動作確認 ✅
   - Railway デプロイメント復旧 ✅
   - API エンドポイント動作確認 ✅
   - リアルタイム分析機能確認 ✅
   - ボタン・フォーム機能確認 ✅

### 修復結果:
- **ウェブサイト**: https://web-production-1f4ce.up.railway.app ✅ 完全復旧
- **ダッシュボード**: 全機能正常動作
- **設定ページ**: ボタン・フォーム動作確認
- **API接続**: GMO Coin API 正常通信
- **取引ボット**: バックグラウンド監視実行中
- **リアルタイム更新**: 30秒間隔で正常動作

---
**最終更新**: 2025年8月26日  
**ステータス**: 24時間完全稼働中 ✅ (緊急修復完了・全機能正常動作)  
**現在価格**: DOGE/JPY ¥31.377  
**GitHubコミット**: d99b3eb - 緊急システム修復完了